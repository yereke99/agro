<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
  <title>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</title>
  <style>
    :root{
      --bg:#f6f9f4; --ink:#0b1f0b; --muted:#6b806b; --brand:#19a461; --brand-2:#88c057;
      --danger:#e53935; --card:#ffffff; --border:#e7efe2; --shadow:0 10px 30px rgba(25,164,97,.15);
    }
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,system-ui,Arial,sans-serif}
    .header{position:sticky; top:0; z-index:10; background:linear-gradient(180deg,#ffffff,#f3f8ef); border-bottom:1px solid var(--border); padding:10px 16px 12px; display:flex; align-items:center; justify-content:space-between; gap:12px; backdrop-filter:saturate(140%) blur(8px);}
    .title{font-weight:900}
    .sub{font-size:12px;color:var(--muted)}
    .container{padding:12px 16px 120px}
    .card{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:12px;margin-bottom:12px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 0;border-bottom:1px solid var(--border)}
    .row:last-child{border-bottom:0}
    .muted{font-size:12px;color:var(--muted)}
    .total{font-weight:900;font-size:16px}
    .radio{display:flex;gap:8px;flex-wrap:wrap}
    .radio label{display:flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:#fff;cursor:pointer;font-size:14px}
    .radio input{accent-color:var(--brand)}
    .input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:#fff;outline:none}
    .mapHdr{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px}
    .mapWrap{height:260px;border-radius:12px;border:1px solid var(--border);overflow:hidden;position:relative;transition:height .2s ease; touch-action:none;}
    .mapWrap.expanded{height:70vh}
    .mapTools{position:absolute;left:8px;top:8px;right:8px;display:flex;gap:8px;z-index:2}
    .tool{flex:1;display:flex;gap:6px;background:rgba(255,255,255,.95);border:1px solid var(--border);border-radius:10px;padding:8px}
    .tool input{flex:1;border:0;outline:none;background:transparent}
    .btnSm{padding:8px 10px;border:1px solid var(--border);background:#fff;border-radius:10px;cursor:pointer;font-size:13px}
    .suggest{position:absolute;left:8px;right:8px;top:48px;background:#fff;border:1px solid var(--border);border-radius:10px;box-shadow:var(--shadow);z-index:3;max-height:220px;overflow:auto;display:none}
    .sugItem{padding:10px 12px;border-bottom:1px solid var(--border);cursor:pointer}
    .sugItem:last-child{border-bottom:0}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    .list{max-height:240px;overflow:auto}
    .item{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border)}
    .item:last-child{border-bottom:0}
    .qty{font-size:12px;color:var(--muted)}
    .floating{position:fixed;left:16px;right:16px;bottom:calc(16px + var(--tg-safe-area-inset-bottom,0px));display:flex;gap:8px;z-index:50}
    .btn{flex:1;padding:14px;border-radius:14px;border:0;background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#fff;font-weight:900;cursor:pointer}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .danger{background:var(--danger)}
  </style>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://api-maps.yandex.ru/v3/?apikey=8a3e4da0-9ef2-4176-9203-e7014c1dba6f&lang=ru_RU"></script>
</head>
<body>
<header class="header">
  <div>
    <div class="title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
    <div class="sub">–ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–∫–∞–∑ –∏ –∞–¥—Ä–µ—Å</div>
  </div>
</header>

<div class="container">
  <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
  <div class="card">
    <div class="muted" style="margin-bottom:6px">–ö–æ—Ä–∑–∏–Ω–∞</div>
    <div id="cartList" class="list"></div>
    <div class="row">
      <div class="muted">–¢–æ–≤–∞—Ä—ã</div>
      <div id="goodsTotal" class="total">0 ‚Ç∏</div>
    </div>
    <div class="row">
      <div class="muted">–î–æ—Å—Ç–∞–≤–∫–∞</div>
      <div id="deliveryPrice" class="total">0 ‚Ç∏</div>
    </div>
    <div class="row">
      <div>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</div>
      <div id="grandTotal" class="total">0 ‚Ç∏</div>
    </div>
  </div>

  <!-- –°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è -->
  <div class="card">
    <div class="muted" style="margin-bottom:6px">–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è</div>
    <div class="radio">
      <label><input type="radio" name="dtype" value="delivery" checked/> –î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ–º–æ–π</label>
      <label><input type="radio" name="dtype" value="pickup"/> –°–∞–º–æ–≤—ã–≤–æ–∑</label>
    </div>
    <div id="pickupHint" class="hint" style="display:none">–°–∞–º–æ–≤—ã–≤–æ–∑ —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ä–∞–Ω–µ–µ —Ç–æ—á–∫–∏.</div>
  </div>

  <!-- –ù–û–í–û–ï: –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã -->
  <div class="card">
    <div class="muted" style="margin-bottom:6px">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</div>
    <div class="radio">
      <label><input type="radio" name="pay" value="kaspi_link" checked/> Kaspi Pay (–ø–æ —Å—Å—ã–ª–∫–µ)</label>
      <label><input type="radio" name="pay" value="kaspi_transfer"/> –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ Kaspi Gold</label>
      <label><input type="radio" name="pay" value="cash"/> –ù–∞–ª–∏—á–Ω—ã–º–∏</label>
    </div>
    <div class="hint">
      –í—ã–±–µ—Ä–∏—Ç–µ, –∫–∞–∫ –±—É–¥–µ—Ç–µ –æ–ø–ª–∞—á–∏–≤–∞—Ç—å –∑–∞–∫–∞–∑: –ø–æ —Å—Å—ã–ª–∫–µ Kaspi, –ø–µ—Ä–µ–≤–æ–¥–æ–º –Ω–∞ –∫–∞—Ä—Ç—É Kaspi Gold –∏–ª–∏ –Ω–∞–ª–∏—á–Ω—ã–º–∏.
    </div>
  </div>

  <!-- –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ -->
  <div id="deliveryBlock" class="card">
    <div class="mapHdr">
      <div style="font-weight:700">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</div>
      <button id="toggleMap" class="btnSm">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∫–∞—Ä—Ç—É</button>
    </div>
    <input id="address" class="input" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –ø–æ–¥—ä–µ–∑–¥..."/>
    <div class="hint">
      –ú–æ–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é. –ü–∏–Ω –Ω–∞ –∫–∞—Ä—Ç–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å—Ç–∞–≤–∏—Ç—å –∫–ª–∏–∫–æ–º –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ–º. –£–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ/—É–º–µ–Ω—å—à–∞–π—Ç–µ –∫–∞—Ä—Ç—É –∂–µ—Å—Ç–∞–º–∏ (pinch).
    </div>
    <div class="mapWrap" id="mapWrap">
      <div class="mapTools">
        <div class="tool" style="flex:2">
          <input id="search" type="search" placeholder="–ù–∞–π—Ç–∏ –∞–¥—Ä–µ—Å: –ê–±–∞—è 100..." autocomplete="off">
          <button id="searchBtn" class="btnSm" title="–ü–æ–∏—Å–∫">üîç</button>
          <button id="locBtn" class="btnSm" title="–ú–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">üìç</button>
        </div>
      </div>
      <div id="suggest" class="suggest"></div>
      <div id="map" style="width:100%;height:100%"></div>
    </div>
  </div>

  <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
  <div class="card">
    <div style="margin-bottom:8px">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä</div>
    <input id="phone" class="input" placeholder="+7 7xx xxx xx xx"
           type="tel" inputmode="numeric" autocomplete="tel" pattern="[0-9+ ]*">
    <div class="hint">–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–º —á–µ–∫ –≤ Telegram –∏ —Å–≤—è–∂–µ–º—Å—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.</div>
  </div>
</div>

<div class="floating">
  <button id="submitBtn" class="btn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
</div>

<script>
  const YANDEX_API_KEY = '8a3e4da0-9ef2-4176-9203-e7014c1dba6f';

  let telegramId = null;
  try {
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();
    telegramId = Telegram?.WebApp?.initDataUnsafe?.user?.id || null;
  } catch(_) {}

  let cart = JSON.parse(sessionStorage.getItem("agro_cart")||"{}");
  let items = Array.isArray(cart.items)? cart.items : [];
  let goodsTotal = Number(cart.total||0);
  let deliveryPrice = 0;
  let deliveryType = "delivery";
  let paymentMethod = "kaspi_link";   // –ù–û–í–û–ï

  const cartListEl = document.getElementById('cartList');
  const goodsTotalEl = document.getElementById('goodsTotal');
  const deliveryPriceEl = document.getElementById('deliveryPrice');
  const grandTotalEl = document.getElementById('grandTotal');
  const addressEl = document.getElementById('address');
  const phoneEl = document.getElementById('phone');
  const submitBtn = document.getElementById('submitBtn');
  const deliveryBlock = document.getElementById('deliveryBlock');
  const pickupHint = document.getElementById('pickupHint');

  const mapWrapEl = document.getElementById('mapWrap');
  const toggleMapBtn = document.getElementById('toggleMap');
  const searchEl = document.getElementById('search');
  const searchBtn = document.getElementById('searchBtn');
  const suggestEl = document.getElementById('suggest');
  const locBtn = document.getElementById('locBtn');

  let map, marker;
  let coord = {lng:76.886, lat:43.238}; // –ê–ª–º–∞—Ç—ã —Ü–µ–Ω—Ç—Ä
  let debounceTimer = null;

  function fmt(n){ return (Number(n)||0).toLocaleString('ru-RU'); }
  function escapeHtml(s){
    const d=document.createElement('div');
    d.textContent=s??'';
    return d.innerHTML;
  }

  function renderCart(){
    if(!items.length){
      cartListEl.innerHTML = '<div class="muted">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
    } else {
      cartListEl.innerHTML = items.map(x =>
        `<div class="item">
          <div>
            <div>${escapeHtml(x.name||'–¢–æ–≤–∞—Ä')}</div>
            <div class="qty">${x.qty} ${escapeHtml(x.unit||'')}</div>
          </div>
          <div><b>${fmt(x.price)} ‚Ç∏</b></div>
        </div>`
      ).join('');
    }
    goodsTotalEl.textContent = fmt(goodsTotal) + ' ‚Ç∏';
    deliveryPriceEl.textContent = fmt(deliveryPrice) + ' ‚Ç∏';
    grandTotalEl.textContent = fmt(goodsTotal + deliveryPrice) + ' ‚Ç∏';
  }

  async function loadDeliveryPrice(){
    if(deliveryType!=='delivery'){
      deliveryPrice=0;
      renderCart();
      return;
    }
    try{
      const r = await fetch('/api/delivery/price');
      const j = await r.json();
      deliveryPrice = Number(j.price||0);
    }catch(e){
      deliveryPrice = 0;
    }
    renderCart();
  }

  function bindDeliveryType(){
    document.querySelectorAll('input[name="dtype"]').forEach(r=>{
      r.addEventListener('change', ()=>{
        deliveryType = r.value;
        const isDelivery = deliveryType === 'delivery';
        deliveryBlock.style.display = isDelivery ? '' : 'none';
        pickupHint.style.display = isDelivery ? 'none':'block';
        loadDeliveryPrice();
      });
    });
  }

  // –ù–û–í–û–ï: –±–∏–Ω–¥–∏–º —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã
  function bindPaymentMethod(){
    document.querySelectorAll('input[name="pay"]').forEach(r=>{
      r.addEventListener('change', ()=>{
        paymentMethod = r.value; // "kaspi_link" | "kaspi_transfer" | "cash"
      });
    });
  }

  toggleMapBtn.addEventListener('click', ()=>{
    mapWrapEl.classList.toggle('expanded');
    toggleMapBtn.textContent = mapWrapEl.classList.contains('expanded') ? '–°–≤–µ—Ä–Ω—É—Ç—å –∫–∞—Ä—Ç—É' : '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∫–∞—Ä—Ç—É';
  });

  locBtn.addEventListener('click', ()=>{
    if(!navigator.geolocation){ return; }
    navigator.geolocation.getCurrentPosition(pos=>{
      coord.lat = pos.coords.latitude;
      coord.lng = pos.coords.longitude;
      setCenter(coord.lng, coord.lat, true);
      placeMarker(coord.lng, coord.lat);
      reverseGeocodeToInput(coord.lat, coord.lng);
    });
  });

  // ------------ MAP (Yandex v3) -------------
  async function initMap(){
    try { await ymaps3.ready; } catch(e) { console.error(e); return; }
    const {YMap, YMapDefaultSchemeLayer, YMapDefaultFeaturesLayer, YMapListener} = ymaps3;

    map = new YMap(document.getElementById('map'), {
      location: {center:[coord.lng, coord.lat], zoom:14},
      behaviors: ['drag','pinchZoom','scrollZoom','dblClick']
    });
    map.addChild(new YMapDefaultSchemeLayer());
    map.addChild(new YMapDefaultFeaturesLayer());

    placeMarker(coord.lng, coord.lat);

    map.addChild(new YMapListener({
      onClick: (e)=>{
        const [lng, lat] = e.coordinates;
        placeMarker(lng, lat);
        reverseGeocodeToInput(lat, lng);
      }
    }));

    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(pos=>{
        coord.lat = pos.coords.latitude;
        coord.lng = pos.coords.longitude;
        setCenter(coord.lng, coord.lat, true);
        placeMarker(coord.lng, coord.lat);
        reverseGeocodeToInput(coord.lat, coord.lng);
      });
    }
  }

  function setCenter(lng, lat, smooth=false){
    try {
      map.setLocation({
        center:[lng,lat],
        zoom: map.getZoom ? map.getZoom() : 14,
        duration: smooth? 300 : 0
      });
    } catch(_) {}
  }

  function placeMarker(lng, lat){
    coord = {lng, lat};
    if (marker) {
      try { map.removeChild(marker); } catch(_) {}
    }
    const el = document.createElement('div');
    el.style.cssText = "width:22px;height:22px;background:#19a461;border:2px solid #fff;border-radius:50%;box-shadow:0 1px 6px rgba(0,0,0,.4);cursor:grab";

    marker = new ymaps3.YMapMarker(
      {
        coordinates:[lng,lat],
        draggable:true,
        onDragEnd:(e)=>{
          const [mlng, mlat] = e?.coordinates || [lng,lat];
          coord = {lng:mlng, lat:mlat};
          reverseGeocodeToInput(coord.lat, coord.lng);
        }
      },
      el
    );
    map.addChild(marker);
  }

  async function geocodeTextToPoint(text){
    if(!text.trim()) return [];
    const url = `https://geocode-maps.yandex.ru/1.x/?apikey=${encodeURIComponent(YANDEX_API_KEY)}&format=json&lang=ru_RU&results=5&geocode=${encodeURIComponent(text.trim())}`;
    const r = await fetch(url);
    if(!r.ok) return [];
    const j = await r.json().catch(()=> ({}));
    const members = (((j||{}).response||{}).GeoObjectCollection||{}).featureMember||[];
    return members.map(m=>{
      const obj = m.GeoObject||{};
      const name = obj.name||'';
      const text = (((obj.metaDataProperty||{}).GeocoderMetaData||{}).text) || name;
      const pos = ((obj.Point||{}).pos||'').split(' ');
      const lng = parseFloat(pos[0]);
      const lat = parseFloat(pos[1]);
      if (Number.isFinite(lng) && Number.isFinite(lat)) {
        return {name,text,lng,lat};
      }
      return null;
    }).filter(Boolean);
  }

  async function reverseGeocodeToInput(lat, lng){
    try{
      const url = `https://geocode-maps.yandex.ru/1.x/?apikey=${encodeURIComponent(YANDEX_API_KEY)}&format=json&lang=ru_RU&results=1&geocode=${lng},${lat}`;
      const r = await fetch(url);
      if(!r.ok) return;
      const j = await r.json().catch(()=> ({}));
      const members = (((j||{}).response||{}).GeoObjectCollection||{}).featureMember||[];
      if (members.length){
        const md = ((members[0].GeoObject||{}).metaDataProperty||{}).GeocoderMetaData||{};
        const addr = (md.Address||{}).formatted || md.text || '';
        if(addr) addressEl.value = addr;
      }
    }catch(e){ console.warn('reverse geocode', e); }
  }

  searchEl.addEventListener('input', ()=>{
    clearTimeout(debounceTimer);
    const q = searchEl.value.trim();
    if(!q){
      suggestEl.style.display='none';
      suggestEl.innerHTML='';
      return;
    }
    debounceTimer = setTimeout(runSearch, 350);
  });

  searchEl.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter') {
      e.preventDefault();
      runSearch();
    }
  });

  searchBtn.addEventListener('click', runSearch);

  async function runSearch(){
    const q = searchEl.value.trim();
    if(!q){
      suggestEl.style.display='none';
      suggestEl.innerHTML='';
      return;
    }
    try{
      const list = await geocodeTextToPoint(q);
      if(!list.length){
        suggestEl.innerHTML = '<div class="sugItem">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
        suggestEl.style.display='block';
        return;
      }
      suggestEl.innerHTML = list.map((it,i)=>
        `<div class="sugItem" data-i="${i}">${escapeHtml(it.text||it.name||'')}</div>`
      ).join('');
      suggestEl.style.display='block';
      suggestEl.querySelectorAll('.sugItem').forEach(div=>{
        div.addEventListener('click', ()=>{
          const idx = Number(div.getAttribute('data-i'));
          const item = list[idx];
          suggestEl.style.display='none';
          searchEl.blur();
          if(item){
            setCenter(item.lng, item.lat, true);
            placeMarker(item.lng, item.lat);
            addressEl.value = item.text || item.name || addressEl.value;
          }
        });
      });
    }catch(e){
      suggestEl.style.display='none';
      suggestEl.innerHTML='';
    }
  }

  document.addEventListener('click', (e)=>{
    if(!suggestEl.contains(e.target) && e.target !== searchEl){
      suggestEl.style.display='none';
    }
  });

  // Submit
  submitBtn.addEventListener('click', async ()=>{
    const phone = String(phoneEl.value||'').trim();

    if(!items.length){
      alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
      return;
    }
    if(!telegramId){
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å Telegram ID');
      return;
    }

    if(deliveryType==='delivery'){
      if(!phone){
        alert('–£–∫–∞–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω');
        return;
      }
      if(!addressEl.value.trim()){
        alert('–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å');
        return;
      }
    } else {
      if(!phone){
        alert('–£–∫–∞–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏');
        return;
      }
    }

    submitBtn.disabled = true;
    submitBtn.textContent = '‚è≥ –û—Ñ–æ—Ä–º–ª—è–µ–º...';

    try{
      await loadDeliveryPrice();

      const res = await fetch('/api/orders/confirm', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          telegram_id: String(telegramId||''),
          items,
          payment_method: paymentMethod,    // –ù–û–í–û–ï
          delivery: {
            type: deliveryType,
            address: addressEl.value||'',
            phone: phone,
            lat: coord.lat,
            lng: coord.lng,
          }
        })
      });

      const js = await res.json().catch(()=> ({}));
      if(!res.ok){
        throw new Error(js?.error || '–û—à–∏–±–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞');
      }

      if (Telegram?.WebApp?.close) Telegram.WebApp.close();
      else {
        alert('–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram.');
        location.href = '/';
      }
    }catch(e){
      console.error(e);
      alert(e.message || '–û—à–∏–±–∫–∞');
      submitBtn.disabled = false;
      submitBtn.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑';
    }
  });

  (function init(){
    renderCart();
    bindDeliveryType();
    bindPaymentMethod(); // –ù–û–í–û–ï
    loadDeliveryPrice();
    initMap();

    phoneEl.addEventListener('focus', ()=>{
      phoneEl.setAttribute('inputmode','numeric');
    });
  })();
</script>
</body>
</html>
